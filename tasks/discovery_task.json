{
  "name": "Document Discovery Task",
  "description": "Analyzes a legal document using Gemini 2.5 Pro to find all incorporated documents, separating them into 'linked' and 'unlinked' and ignoring defined terms.",
  "enabled": true,
  "system_prompt": "You are an expert legal and compliance document parser. Your task is to meticulously scan the provided text to find all referenced standalone documents and assess their relevance based on specific contexts.\n\n**CRITICAL INSTRUCTIONS:**\n\n1.  **ASSESS RELEVANCE:** You will be given a **Usage Context** (e.g., 'We only use BigQuery') and an **Analysis Goal** (e.g., 'Find legally binding documents'). You MUST use both to assign a `relevance_status` to *every* document you find.\n\n2.  **DISTINGUISH:** You MUST differentiate between simple *defined terms* (like 'Agreement', 'Services', 'Confidential Information') and actual *standalone documents* (like 'Order Form', 'DPA', 'SOW', 'Privacy Policy').\n\n3.  **EXCLUDE DEFINED TERMS:** Do NOT include common defined terms in your output.\n\n4.  **DE-DUPLICATE:** Return only a single, de-duplicated list of unique documents.\n\n5.  **FORMAT:** Return ONLY a JSON object adhering strictly to the output schema.",
  "user_prompt": "CONTEXT:\n**A. Original URL (for resolving relative links):**\n{original_url}\n**B. Our Company's Usage Context:**\n{usage_context}\n**C. Analysis Goal (Legal vs. Security):**\n{search_context}\n**D. Document Text (pre-processed from URL):**\n{document_text}\n**YOUR TASK:**\n1.  Analyze the **Document Text (D)**.\n2.  Find all standalone documents referenced (both linked `[text](url)` and unlinked).\n3.  **Use the Context:** Critically evaluate each document against **Our Company's Usage Context (B)** and the **Analysis Goal (C)**.\n4.  **Resolve Links:** Use the **Original URL (A)** to resolve all relative links (e.g., '/privacy') into absolute URLs.\n5.  **Populate Schema:** Fill the output schema for *every* document found, assigning a `relevance_status` based on your analysis.",
  "llm_model_name": "Kimi K2 0905",
  "llm_config": {
    "temperature": 0.0
  },
  "input_processors": [
    {
      "param_name": "document_text",
      "input_processor": "url_fetcher",
      "config": {
        "extract_text": true
      }
    }
  ],
  "output_format": {
  "discovered_documents": {
    "type": "list",
    "description": "A de-duplicated, unified list of all standalone documents (linked and unlinked) found in the text, triaged for relevance.",
    "nested_structure": {
      "document": {
        "type": "object",
        "nested_structure": {
          "document_name": {
            "type": "str",
            "description": "The proper name of the document (e.g., 'Privacy Policy', 'Order Form')."
          },
          "link_type": {
            "type": "str",
            "description": "Indicates if the document was found as a link or just as text.",
            "options": ["linked", "unlinked"]
          },
          "absolute_url": {
            "type": "str",
            "description": "The fully resolved absolute URL. Empty string if unlinked."
          },
          "relevance_status": {
            "type": "str",
            "description": "Relevance assessment based on the provided Usage Context and Analysis Goal.",
            "options": ["relevant", "irrelevant", "check_manually"]
          },
          "context_quote": {
            "type": "str",
            "description": "The full sentence where this document was mentioned, providing context."
          }
        }
      }
    }
  }
}
}